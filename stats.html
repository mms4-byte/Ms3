<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>إحصائيات الإنجاز الحقيقية</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --royal-navy: #020617; --royal-gold: #f1c40f; --border-gold: rgba(241, 196, 15, 0.2); }
        body { background-color: var(--royal-navy); color: #fff; font-family: 'Cairo', sans-serif; min-height: 100vh; }
        .stats-card { background: rgba(255, 255, 255, 0.02); border: 1px solid var(--border-gold); border-radius: 25px; padding: 20px; margin-bottom: 15px; }
        .back-btn { width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-gold); color: var(--royal-gold); display: flex; align-items: center; justify-content: center; }
        .stat-number { font-size: 1.8rem; font-weight: 900; color: var(--royal-gold); }
    </style>
</head>
<body>

    <header class="p-4 flex items-center justify-between border-b border-yellow-600/20 sticky top-0 bg-slate-950/90 z-50">
        <button class="back-btn" onclick="history.back()"><span class="material-icons">arrow_forward</span></button>
        <h1 class="text-xs font-black tracking-widest">إحصائيات مروة الشاملة</h1>
        <div class="w-10"></div>
    </header>

    <main class="p-5 pb-24">
        <div class="stats-card flex items-center justify-between">
            <div>
                <p class="text-[10px] text-gray-500 font-bold uppercase">إجمالي وقت الدراسة</p>
                <h2 class="stat-number" id="totalStudyTime">00:00:00</h2>
            </div>
            <span class="material-icons text-yellow-600/30 text-4xl">timer</span>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="stats-card text-center">
                <p class="text-[10px] text-red-400 font-bold">الرياضيات</p>
                <div class="stat-number" id="mathSolved">0</div>
                <p class="text-[9px] text-gray-500">سؤال تم حله</p>
            </div>
            <div class="stats-card text-center">
                <p class="text-[10px] text-blue-400 font-bold">الإنجليزي</p>
                <div class="stat-number" id="englishSolved">0</div>
                <p class="text-[9px] text-gray-500">كلمة تم حفظها</p>
            </div>
        </div>

        <div class="stats-card">
            <h3 class="text-xs font-bold text-gray-500 mb-4">مخطط الإنجاز اليومي</h3>
            <canvas id="mainChart" height="200"></canvas>
        </div>
    </main>

    <script>
        // دالة لجلب البيانات الحقيقية من كل الصفحات السابقة
        function loadRealStats() {
            // 1. جلب بيانات الرياضيات (بناءً على الكود السابق)
            const mathData = JSON.parse(localStorage.getItem('math_stats')) || { solved: 0 };
            document.getElementById('mathSolved').innerText = mathData.solved;

            // 2. جلب بيانات الإنجليزي
            const englishData = JSON.parse(localStorage.getItem('english_stats')) || { words: 0 };
            document.getElementById('englishSolved').innerText = englishData.words;

            // 3. جلب الوقت الكلي
            const totalSeconds = localStorage.getItem('total_time_spent') || 0;
            document.getElementById('totalStudyTime').innerText = formatTime(totalSeconds);

            // 4. تحديث الرسم البياني
            updateChart(mathData.solved, englishData.words);
        }

        // تحويل الثواني إلى صيغة وقت (ساعة:دقيقة:ثانية)
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function updateChart(math, english) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['الرياضيات', 'الإنجليزي'],
                    datasets: [{
                        label: 'عدد الإجابات الصحيحة',
                        data: [math, english],
                        backgroundColor: ['rgba(239, 68, 68, 0.7)', 'rgba(59, 130, 246, 0.7)'],
                        borderRadius: 10
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // عداد الوقت يحسب طول ما الطالب فاتح الصفحة
        setInterval(() => {
            let currentTotal = parseInt(localStorage.getItem('total_time_spent') || 0);
            currentTotal++;
            localStorage.setItem('total_time_spent', currentTotal);
            document.getElementById('totalStudyTime').innerText = formatTime(currentTotal);
        }, 1000);

        window.onload = loadRealStats;
    </script>
</body>
</html>
