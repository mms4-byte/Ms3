<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إضافة منتجات - DEN PRO</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #F7F9FB;
            color: #102A43;
        }
        .primary-bg { background-color: #0B6E4F; }
        .primary-text { color: #0B6E4F; }
        .accent-bg { background-color: #FFC857; }
        .accent-text { color: #FFC857; }
        .success-bg { background-color: #2BB673; }
        .error-bg { background-color: #E94F37; }
        .card-shadow { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-30">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <button onclick="history.back()" class="p-2 rounded-full hover:bg-gray-100">
                <i data-feather="arrow-right"></i>
            </button>
            <h1 class="text-xl font-bold primary-text">إضافة منتجات</h1>
            <div class="w-8"></div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6">
        <!-- Categories -->
        <div class="mb-6">
            <div class="flex space-x-2 space-x-reverse overflow-x-auto pb-2">
                <button class="category-btn px-4 py-2 bg-primary-bg text-white rounded-full text-sm font-medium" data-category="fruits">فواكه</button>
                <button class="category-btn px-4 py-2 bg-white rounded-full text-sm font-medium card-shadow" data-category="vegetables">خضراوات</button>
                <button class="category-btn px-4 py-2 bg-white rounded-full text-sm font-medium card-shadow" data-category="food">مواد غذائية</button>
                <button class="category-btn px-4 py-2 bg-white rounded-full text-sm font-medium card-shadow" data-category="meat">لحوم</button>
                <button class="category-btn px-4 py-2 bg-white rounded-full text-sm font-medium card-shadow" data-category="other">أخرى</button>
            </div>
        </div>

        <!-- Products List -->
        <div id="products-list" class="space-y-3 mb-6">
            <!-- Products will be dynamically added here -->
        </div>

        <!-- Manual Add Button -->
        <button id="manual-add-btn" class="w-full py-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-primary hover:text-primary transition mb-6" data-aos="fade-up">
            <div class="flex items-center justify-center space-x-2 space-x-reverse">
                <i data-feather="plus" class="w-5 h-5"></i>
                <span>إضافة منتج يدوي</span>
            </div>
        </button>

        <!-- Total -->
        <div class="bg-white rounded-lg p-4 card-shadow mb-6" data-aos="fade-up">
            <div class="flex items-center justify-between">
                <span class="font-bold text-lg">المجموع الكلي</span>
                <span id="total-amount" class="font-bold text-lg primary-text">₪ 0.00</span>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex space-x-3 space-x-reverse" data-aos="fade-up">
            <button id="cancel-btn" class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition">إلغاء</button>
            <button id="save-btn" class="flex-1 py-3 primary-bg text-white rounded-lg font-medium hover:bg-opacity-90 transition">حفظ</button>
        </div>
    </div>

    <!-- Manual Add Modal -->
    <div id="manual-add-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md" data-aos="zoom-in">
            <div class="p-6">
                <h2 class="text-xl font-bold mb-4 primary-text">إضافة منتج يدوي</h2>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">اسم المنتج</label>
                    <input type="text" id="product-name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="أدخل اسم المنتج">
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">السعر</label>
                        <input type="number" id="product-price" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">الكمية</label>
                        <input type="number" id="product-quantity" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" value="1">
                    </div>
                </div>

                <div class="flex space-x-3 space-x-reverse">
                    <button id="cancel-add" class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition">إلغاء</button>
                    <button id="add-product" class="flex-1 py-3 primary-bg text-white rounded-lg font-medium hover:bg-opacity-90 transition">إضافة</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize animations and icons
        AOS.init({
            duration: 600,
            easing: 'ease-out-cubic'
        });

        // Sample products data
        let products = [
            {
                id: 1,
                name: "تفاح",
                price: 15,
                quantity: 2,
                category: "fruits"
            },
            {
                id: 2,
                name: "موز",
                price: 8,
                quantity: 3,
                category: "fruits"
            }
        ];

        // Calculate total
        function calculateTotal() {
            let total = 0;
            products.forEach(product => {
                total += product.price * product.quantity;
            });
            document.getElementById('total-amount').textContent = `₪ ${total.toFixed(2)}`;
            return total;
        }

        // Render products list
        function renderProducts(category = 'all') {
            const productsList = document.getElementById('products-list');
            productsList.innerHTML = '';
            
            let filteredProducts = products;
            if (category !== 'all') {
                filteredProducts = products.filter(product => product.category === category);
            }
            
            if (filteredProducts.length === 0) {
                productsList.innerHTML = '<div class="text-center py-6 text-gray-500">لا توجد منتجات في هذه الفئة</div>';
                return;
            }
            
            filteredProducts.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'bg-white rounded-lg p-4 card-shadow';
                productDiv.dataset.aos = 'fade-up';
                productDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-medium">${product.name}</span>
                        <button class="remove-btn p-1 rounded-full hover:bg-gray-100" data-id="${product.id}">
                            <i data-feather="x" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">السعر</label>
                            <input type="number" min="0" class="price-input w-20 p-2 border border-gray-300 rounded text-center" value="${product.price}" data-id="${product.id}">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">الكمية</label>
                            <input type="number" min="1" class="quantity-input w-16 p-2 border border-gray-300 rounded text-center" value="${product.quantity}" data-id="${product.id}">
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm text-gray-600 mb-1">المجموع</label>
                            <div class="total-display p-2 bg-gray-100 rounded text-center font-medium">₪ ${(product.price * product.quantity).toFixed(2)}</div>
                        </div>
                    </div>
                `;
                productsList.appendChild(productDiv);
            });
            
            // Update feather icons
            feather.replace();
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    removeProduct(id);
                });
            });
            
            // Add event listeners to price and quantity inputs
            document.querySelectorAll('.price-input, .quantity-input').forEach(input => {
                input.addEventListener('input', function() {
                    const id = parseInt(this.dataset.id);
                    const type = this.classList.contains('price-input') ? 'price' : 'quantity';
                    updateProduct(id, type, parseFloat(this.value));
                });
            });
        }

        // Add new product
        function addProduct(name, price, quantity, category) {
            const newProduct = {
                id: Date.now(),
                name: name,
                price: parseFloat(price),
                quantity: parseInt(quantity),
                category: category
            };
            products.push(newProduct);
            renderProducts();
            calculateTotal();
        }

        // Remove product
        function removeProduct(id) {
            products = products.filter(product => product.id !== id);
            renderProducts();
            calculateTotal();
        }

        // Update product
        function updateProduct(id, type, value) {
            const product = products.find(p => p.id === id);
            if (product) {
                product[type] = value;
                renderProducts();
                calculateTotal();
            }
        }

        // Category filter
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                document.querySelectorAll('.category-btn').forEach(b => {
                    b.classList.remove('bg-primary-bg', 'text-white');
                    b.classList.add('bg-white', 'text-gray-700');
                });
                
                // Add active class to clicked button
                this.classList.remove('bg-white', 'text-gray-700');
                this.classList.add('bg-primary-bg', 'text-white');
                
                // Render products for selected category
                renderProducts(this.dataset.category);
            });
        });

        // Manual add modal
        document.getElementById('manual-add-btn').addEventListener('click', function() {
            document.getElementById('manual-add-modal').classList.remove('hidden');
        });

        document.getElementById('cancel-add').addEventListener('click', function() {
            document.getElementById('manual-add-modal').classList.add('hidden');
        });

        document.getElementById('add-product').addEventListener('click', function() {
            const name = document.getElementById('product-name').value;
            const price = document.getElementById('product-price').value;
            const quantity = document.getElementById('product-quantity').value;
            
            if (name && price && quantity) {
                addProduct(name, price, quantity, 'other');
                document.getElementById('product-name').value = '';
                document.getElementById('product-price').value = '';
                document.getElementById('product-quantity').value = '1';
                document.getElementById('manual-add-modal').classList.add('hidden');
            } else {
                alert('الرجاء ملء جميع الحقول');
            }
        });

        // Close modal when clicking outside
        document.getElementById('manual-add-modal').addEventListener('click', function(e) {
            if(e.target === this) {
                this.classList.add('hidden');
            }
        });

        // Save button
        document.getElementById('save-btn').addEventListener('click', function() {
            alert('تم حفظ المنتجات بنجاح');
            // Here you would typically save to localStorage or send to server
            localStorage.setItem('products', JSON.stringify(products));
            history.back();
        });

        // Cancel button
        document.getElementById('cancel-btn').addEventListener('click', function() {
            if (confirm('هل أنت متأكد من إلغاء العملية؟')) {
                history.back();
            }
        });

        // Initialize
        renderProducts();
        calculateTotal();
        feather.replace();
    </script>
</body>
</html>